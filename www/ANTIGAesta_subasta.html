<!DOCTYPE html> 
<html>
<head>
  <meta charset="UTF-8">
  <title>Asociado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">


<script src="jquery.min.js"></script>
<script src="bootstrap.min.js"></script>
<script src="http://elmundo.webexpo.es/elmundo.js"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
<link rel="stylesheet" href="estils_boots.css" />
<link rel="stylesheet" href="bootstrap.min.css" />
<link rel="stylesheet" href="sidebar.css" />
<link rel="stylesheet" href="estils.css" />
<style>
	.fons1{background:url('http://elmundo.webexpo.es/img/5117908f2bd3aa0e0aaf4f2655cd8bfa.jpg');background-repeat:no-repeat;background-size:cover;-webkit-background-size: cover;-moz-background-size:cover;}
	.fons2{background:url('http://elmundo.webexpo.es/img/5117908f2bd3aa0e0aaf4f2655cd8bfa.jpg');background-repeat:no-repeat;background-size:cover;-webkit-background-size: cover;-moz-background-size:cover;}
	.fons3{background:url('http://elmundo.webexpo.es/img/5117908f2bd3aa0e0aaf4f2655cd8bfa.jpg');background-repeat:no-repeat;background-size:cover;-webkit-background-size: cover;-moz-background-size:cover;}
	.fons4{background:url('http://elmundo.webexpo.es/img/5117908f2bd3aa0e0aaf4f2655cd8bfa.jpg');background-repeat:no-repeat;background-size:cover;-webkit-background-size: cover;-moz-background-size:cover;}
	.fons5{background:url('http://elmundo.webexpo.es/img/5117908f2bd3aa0e0aaf4f2655cd8bfa.jpg');background-repeat:no-repeat;background-size:cover;-webkit-background-size: cover;-moz-background-size:cover;}
</style>

<style>
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }
</style>

</head>

<body> 


<div id="wrapper" class="toggle">
      
<!-- Sidebar -->
      <div id="sidebar-wrapper">
      <ul id="sidebar_menu" class="sidebar-nav">
           <li class="sidebar-brand"></li>
      </ul>
        <ul class="sidebar-nav" id="sidebar">
        	
        	
                                   

           	
           	
          <li id="div_Result"></li>
          <li><a href="segunda.html">Inicio <img style="width:17px;float:right;margin-right:25px;margin-top:12px;" src="icones/home-1.svg" alt="HOME" title="HOME" /></a></li>
          <li><a href="perfil.html">Mi perfil <img style="width:17px;float:right;margin-right:25px;margin-top:12px;" src="icones/user-6.svg" alt="PERFIL" title="PERFIL" /></a></li>
          <li><a href="mis_subastas.html">Mis subastas<img style="width:17px;float:right;margin-right:25px;margin-top:12px;" src="icones/calendar-5.svg" alt="subastas" title="subastas" /></a></li>
<li><a href="subastas_asociados.html">Subastas publicadas<img style="width:17px;float:right;margin-right:25px;margin-top:12px;" src="icones/calendar-5.svg" alt="Subastas publicadas" title="Subastas publicadas" /></a></li>

          <li><a href="#" data-role="button" id="closeapp_2">Desconectar<img style="width:17px;float:right;margin-right:25px;margin-top:12px;" src="icones/error.svg" alt="Desconectar" title="Desconectar" /></a></li>
        
        
          

      
        
            
        
        
        
        
        
        
        
        
        
        </ul>
      </div>
<!-- Sidebar -->  
          
          
    <div class="container-fluid">      
    
<div id="page-content-wrapper"> 	


	
<div class="row marginvbaix page-header">	
  <div class="col-xs-8">
  	<img src="img/logotipointerior.svg" alt="" title="" style="width:100%;" />
  </div>
  <div class="col-xs-2 text-right">
  <a href="professionals.html"><img  class="medidabar"  src="icones/user-4.svg" alt="Profesionales" title="Profesionales" /></a>
  </div>

  <div class="col-xs-2 text-right">
  <a id="menu-toggle" href="#"><img  class="medidabar2"  src="icones/settings-5.svg" alt="MENU" title="MENU" /></a>
  </div>
  </div> 

<form action="subastas_asociados.html" method="POST">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">

		<h2>Estos son los datos de la subasta seleccionada</h2>
		<br />
		<br />
		<p>&nbsp;</p>
						
				<table class="table table-striped">
					<thead>
						<tr>
							<th  colspan=2 class="text-center">Datos de contacto</th>
						</tr>
					</thead>
					<tbody id="mostrardatos">
					</tbody>
				</table>
			</div>
		</div>	
	</div>
</form>

							

</div>

 
          
<script type="text/javascript">


	
$(document).ready(function(){
                    
	// Recupera los datos
	var datosUsuario	= sessionStorage.getItem('datosUsuario');
	var datosPassword	= sessionStorage.getItem('datosPassword');
	var subastaseleccionada	= sessionStorage.getItem('subastaseleccionada');

	// Inicialización de la pantalla
	//
  	archivoValidacion = "http://elmundo.webexpo.es/procesos.php?jsoncallback=?";
	$.getJSON( archivoValidacion, { usuario:datosUsuario ,password:datosPassword })
	.done(function(respuestaServer) {
		if(respuestaServer.validacion != "ok") {
			// Si no pasa la comprobación de usuario / contraseña, vuelve a la pantalla inicial
			window.location.replace('index.html');
		}
		else {
		// elegimos una imagen de fondo al azar
			var randomID = new Date().getTime();
			
	// en index.php, se aplica sobre .ui-page		
/*			$('.ui-page').css({
				"background-image": "url('http://elmundo.webexpo.es/" + respuestaServer.ImagenDeFondo + "?r=" + randomID+ "')",
				"background-repeat": "repeat",
				"background-position": "top center"
				}); 
*/			
			
	// en segunda.php, se aplica sobre body, pero hace dos refrescos, uno ajustando ancho y otro ajustando alto. A mejorar		
/*			$('body').css({
				"background-image": "url('http://elmundo.webexpo.es/" + respuestaServer.ImagenDeFondo + "?r=" + randomID+ "')",
				"background-repeat": "repeat",
				"background-position": "top center"
				});
*/
			
	// elegimos un anuncio de pie al azar	
	//		$("#bannerinferior").html('<img style="width:100%" src="' + respuestaServer.BannerPublicitario + '">');

		}
	});

		
	// Boton desconectar	
	$("#closeapp_2").click(function() {
	
  	archivoValidacion = "http://elmundo.webexpo.es/validacion_de_datos.php?jsoncallback=?"

	$.getJSON( archivoValidacion, {logout:1})
	.done(function(respuestaServer) {
		if(respuestaServer.validacion == "ok") {
		 	/// si el logout es correcto, borramos el sessionStorage volvemos a inicio
			sessionStorage.setItem('datosUsuario', null);
			sessionStorage.setItem('datosPassword', null);
			sessionStorage.setItem('CategoriaBase', null);	
			sessionStorage.setItem('CategoriaNivel1', null);
			sessionStorage.setItem('CategoriaNivel2', null);
			sessionStorage.setItem('Explicacion', null);
			sessionStorage.setItem('imgData', null);
			
			window.location.href="index.html";
		} else {
            alert('Por algun motivo tecnico, no podemos desconectar su sesion');
			window.location.href="index.html";
		}
  
	})
	return false;		
	});	
		
	// Boton desconectar	
	$('#closeapp').submit(function() {	 
		navigator.app.exitApp();
	});		
	
	// Actualitza listasubastas
	
	var url="http://elmundo.webexpo.es/subastas.php";
	url = url + "?usuario=" + datosUsuario + "&password=" + datosPassword + "&accion=detalle&idsubasta=" + subastaseleccionada;
	
	$.getJSON(url,function(mensaje, validacion) {

		var newRow = '';

		if (validacion == 'success') {
			if (mensaje.validacion == 'ok') {
				$.each(mensaje.lista, function(ID, data){
					newRow = newRow + '<tr><td>Nombre</td><td>' + data.Nombre + '</td></tr>';
					newRow = newRow + '<tr><td>Apellidos</td><td>' + data.Apellidos + '</td></tr>';
					newRow = newRow + '<tr><td>Tel&eacute;fono de contacto</td><td>' + data.Telefono + '</td></tr>';
					newRow = newRow + '<tr><td>Email de contacto</td><td>' + data.Email + '</td></tr>';					
					newRow = newRow + '<tr><td></td><td></td></tr>';
					newRow = newRow + '<tr><td>Categoria</td><td>' + data.CategoryCodesDesc +'</td></tr>';
					newRow = newRow + '<tr><td>Descripci&oacute;n</td><td>' + data.Description +'</td></tr>';
					newRow = newRow + '<tr><td>Precio ofertado</td><td>'+ data.Price +' &euro;</td></tr>';
					newRow = newRow + '<tr><td></td><td><img style="width=300px" src="'+data.Image+'"></td></tr>';
					
					newRow = newRow + '<tr><td></td><td></td></tr>';
					
					// Botones de accion
					
					switch (Number(data.Status)) {

							case 5 : 
								newRow = newRow + '<tr><td colspan=2><div class="grupbtns" id="capabotons_'+data.Id+'"><button type="button" class="btn btn-info" id="volver"><i class="fa fa-arrow-left fa-2x" aria-hidden="true"></i></button><button type="button" class="btn btn-success" id="confirmar_'+data.Id+'"><i class="fa fa-check-square fa-2x" aria-hidden="true"></i></button><button type="button" class="btn btn-warning" id="liberar_'+data.Id+'"><i class="fa fa-undo fa-2x" aria-hidden="true"></i></button></div></td></tr>';
								break;
								
							default : 
								newRow = newRow + '<tr><td colspan=2><div class="grupbtns" id="capabotons_'+data.Id+'"><button type="button" class="btn btn-info" id="volver"><i class="fa fa-arrow-left fa-2x" aria-hidden="true"></i></button></td></tr>';
								
								break;
							}

					$(newRow).appendTo("#mostrardatos");
					
					// Acciones de los Botones
					// Boton Volver, común en todos los casos.
					
					var nom1 = '#volver';
					$(nom1).click(function () {
						if (data.Status == 94 || data.Status == 98) 
							window.location.href = 'misventas.html';
						else
							window.location.href = 'subastas_asociados.html';
					});
					
					if (data.Status == 5) {
						var nom2 = '#confirmar_' + data.Id;
						var nom3 = '#liberar_' + data.Id;


						$(nom2).click(function () {
							var url = "http://elmundo.webexpo.es/subastas.php";
							url = url + "?usuario=" + datosUsuario + "&password=" + datosPassword + "&idsubasta="+ data.Id +"&accion=confirmar";
							$.getJSON(url,function(mensaje, validacion) {
								if (validacion == 'success') {
									alert ('Has confirmado que aceptas la oferta. Esta oferta solo podrá cerrarse o cancelarse.');
									window.location.href = 'subastas_asociados.html';
								} else {
									alert ('Ha habido algun problema para aceptar la oferta. El motivo es : ' + html_entity_decode(mensaje.mensaje, 'ENT_QUOTES'));
								}
							});
						});

						$(nom3).click(function () {
							var url = "http://elmundo.webexpo.es/subastas.php";
							url = url + "?usuario=" + datosUsuario + "&password=" + datosPassword + "&idsubasta="+ data.Id +"&accion=liberar";
							$.getJSON(url,function(mensaje, validacion) {
								if (validacion == 'success') {
									alert ('Has liberado esta oferta. La oferta sigue su curso.');
									window.location.href = 'subastas_asociados.html';
								} else {
									alert ('Ha habido algun problema para liberar la oferta. El motivo es : ' + html_entity_decode(mensaje.mensaje, 'ENT_QUOTES'));
								}
							});
						});
					}
					
					
					
				});
			} else { alert ('Ha habido un error, motivo '+ html_entity_decode(mensaje.mensaje, 'ENT_QUOTES'));}
		} else { alert ('Ha habido un error, motivo '+ html_entity_decode(validacion, 'ENT_QUOTES'));}
	});
			
	
	
	
 //if (response_estado==1){                           
                            
//	$("#div_Result").html("<li>"+response_nom+response_cognom+"</li>"	);
			                       
	                               //una vez logeados mostramos el JSON del array recuperado de la bbdd
//	                               var url="http://elmundo.webexpo.es/rebote.php";
//			                           $("#div_Result2").html("");
			                           /*$.getJSON(url,function(clientes){
			                           $.each(clientes, function(i,cliente){
			                           var newRow =                            
"<div class=\"thumbnail\"><div class=\"row martup\"><div class=\"col-xs-12 jshue\"><h2>"+cliente.Name+ " " + cliente.Surname +"</h2></div></div></div>"                           
			                           $(newRow).appendTo("#div_Result2");
			                           });
			                           });*/	
			                           
			                           
			                                                  
//  } else {//si 0 porque no se pudo elimnar
//    window.location.href = 'index.html';
//}                            
             
                    
});
                
   

           	



    </script>





	<script type="text/javascript">
	$("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("active");
});

$(document).ready(function(){
    var classCycle=['fons1','fons2','fons3','fons4','fons5'];

    var randomNumber = Math.floor(Math.random() * classCycle.length);
    var classToAdd = classCycle[randomNumber];

    $('body').addClass(classToAdd);

});

	</script>

</body>
</html>
