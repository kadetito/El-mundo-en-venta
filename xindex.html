f<!DOCTYPE html> 
<html>
<head>
  <meta charset="UTF-8">
  <title>El mundo en venta App oficial</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
<link rel="stylesheet" href="css/app.css" />

<script src="http://elmundo.webexpo.es/elmundo.js"></script>

<style>
.overley { 
    background-color: rgba(0,0,0,0.7);
}
.botogroc{background-color: #ED3521 !important;}
</style>
<!--<script src="facebookSDK.js"></script>-->
</head>
<body> 

<!-- <div id="fb-root"></div> 
	
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v3.1&appId=248518525968656&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>
-->	
	
<div id="page-content-wrapper"> 

<!--login-->
<div data-role="page" id="inicio">
	<div data-role="content">	




		<img src="http://elmundo.webexpo.es/images/logotipointerior.png" alt="" title="" style="width:100%;" />

		<h2 style="margin-top:50px;margin-bottom:50px;text-align:center;">Compra lo que pienses!</h2>
		
		
		
	<div class="thefooter">
				<form id="formulario" method="post">
		      	<p><label> Usuario </label>
		      			<input type="email" data-role="none" placeholder="Escribe tu e-mail" class="myinput" id="nombredeusuario"  name="nombredeusuario"></p>
		      	<p><label> Tu contrase&ntilde;a </label>
		     			<input type="password" id="clave" placeholder="Escribe tu contrase&ntilde;a" data-role="none" class="myinput"  name="clave" ></p>
				  <div class="ui-grid-a">
				 			<div class="ui-block-a"><button type="submit" data-role="button"  value="Login" id="botonLogin"  data-icon="check">Conectar</button></div>
						 <div class="ui-block-b"  style="text-align: right !important;"><a href="#alta" data-transition="slidefade"><button data-role="button"   style="text-align: right !important;" data-icon="star">Inscribirse</button></a></div>
					</div>  		
			</form>	
		<p align="center"><a href="#remember" data-transition="pop">No recuerdo mi contrase&ntilde;a</a></p>	
	</div>
	
			

</div>
</div>
	<!--login-->


	<!--registre-->
<div data-role="page" id="alta">
	<div data-role="content">
				<p style="text-align:center"><img src="http://elmundo.webexpo.es/images/logotipointerior.png" alt="" title="" style="width:75%;" /></p>
		<h4><div id="descripcion_alta">Para mejorar el uso de esta aplicaci&oacute;n, tu experiencia ser&aacute; mejor si nos facilitas algunos datos...</div></h4>		
	<div id="register_form">
	<form name="register" method="post" action="">
		
		<p><label for="nom">Tu nombre:</label>
		<input type="text" placeholder="Escribe aqu&iacute; tu nombre" data-role="none" class="myinput" id="nom" name="nom" required="required" />
		<label class="error" for="nom" id="nom_error">Deberias indicar tu nombre, te llamaremos cuando se acepte tu oferta</label></p>
		
		
		<p><label for="cognom">Tus Apellidos:</label>
		<input type="text" placeholder="Escribe aqu&iacute; tus apellidos" data-role="none" class="myinput" id="cognom" name="cognom" required="required"/>
		<label class="error" for="cognom" id="cognom_error">Deberias indicar tus apellidos, te llamaremos cuando se acepte tu oferta</label></p>		

		<p><label for="telefon">Tu Tel&eacute;fono:</label>
		<input type="tel" placeholder="Escribe aqu&iacute; tu n&uacute;mero de tel&eacute;fono" data-role="none" class="myinput" id="telefon" name="telefon" required="required"/>
		<label class="error" for="telefon" id="telefon_error">Necesitamos tener un tel&eacute;fono de contacto, te llamaremos cuando se acepte tu oferta</label></p>		
		
		
		<p><label for="nombre">E-mail:</label>
		<input type="email" placeholder="Escribe un e-mail que sea v&aacute;lido" data-role="none" class="myinput" id="name" name="name" />
		<label class="error" for="name" id="name_error">Debes indicarnos un E-mail v&aacute;lido, ser&aacute; tu c&oacute;digo de usuario para acceder a la aplicaci&oacute;n y donde te mandaremos las notificaciones</label></p>
		
		<p><label for="password">Elige una contrase&ntilde;a:</label>
		<input type="password" placeholder="Escribe aqu&iacute; una contrase&ntilde;a, de como m&iacute;nimo 5 car&aacute;cteres y que tenga como m&iacute;nimo una letra y una cifra" data-role="none" class="myinput" id="password" name="password" />
		<label class="error" for="password" id="pass_error">Por favor, indica una contrase&ntilde;a para podert conectar otro d&iacute;a a esta aplicaci&oacute;n</label></p>	
		
		<p><label for="password2">Repita la misma contrase&ntilde;a:</label>
		<input type="password" placeholder="Por seguridad, escriba de nuevo la contrase&ntilde;a." data-role="none" class="myinput" id="password2" name="password2" />
	    <label class="error" for="password2"  id="pass_error2">Escriba exactamente la misma contrase&ntilde;a</label></p>	
		
  <div class="ui-grid-a">
 <div class="ui-block-a"><input name="submit" type="submit" value="Reg&iacute;strarte" id="enviar-btn" data-role="button" class="botoblau" /></div>
 <div class="ui-block-b"><a href="#inicio" data-transition="slidefade"><input type="button" data-role="button"  class="botogroc" value="Atr&aacute;s" /></a></div>
</div>  				
	</form>
</div>	
	</div>
<!--	<div style="height:50px;" class="text-center"><a href="index.html" class="btn btn-default massfh groddo  biff" style="height:80px;width:80px;line-height:80px;display:inline-block;">atr&aacute;s</a></div>	-->
	<div style="height:300px;"></div>
</div>
	<!--registre-->



	<!--recuperar-->
<div data-role="page" id="remember">
	<div data-role="content">
				<p style="text-align:center"><img src="http://elmundo.webexpo.es/images/logotipointerior.png" alt="" title="" style="width:75%;" /></p>

		
		
		<div class="thefooter2">	
					<h5>Para recuperar tus datos, por favor, ind&iacute;canos tu correo electr&oacute;nico y te los mandaremos</h5>	
	<div id="remember_form">
<form name="nuevo_empleado" action="" onsubmit="enviarDatosEmpleado(); return false">
		<p><label for="nombre">E-mail:</label>
		<input type="email"  data-role="none" class="myinput" id="emailrecuperar" name="emailrecuperar" required="required" />
	
  <div class="ui-grid-a">
 <div class="ui-block-a"><input name="submit" type="submit" value="Recuperar" id="enviar-recuperar" data-role="button" class="botoblau" /></div>
 <div class="ui-block-b"><a href="#inicio" data-transition="slidefade"><input type="button" data-role="button"  class="botogroc" value="Login" /></a></div>
</div>  
	
	</p>
	</form>
</div>
</div>


	<div style="height:50px;" class="text-center"><a href="index.html" class="btn btn-default massfh groddo  biff" style="height:80px;width:80px;line-height:80px;display:inline-block;">atr&aacute;s</a></div>	<div style="height:300px;"></div>

	
	</div>
</div>
	<!--recuperar-->

	<div style="height:50px;"></div>
<div id="bannerinferior" style="position: fixed; z-index:999;bottom: 0px"></div>

</div>
<script>
	
//LOGIN
$('#formulario').submit(function() { 
	// recolecta los valores que inserto el usuario
	var datosUsuario = $("#nombredeusuario").val()
	var datosPassword = $("#clave").val()
	
  	archivoValidacion = "http://elmundo.webexpo.es/validacion_de_datos.php?jsoncallback=?"

	$.getJSON( archivoValidacion, { usuario:datosUsuario ,password:datosPassword})
	.done(function(respuestaServer) {
		
//		alert(respuestaServer.mensaje + " " + respuestaServer.validacion + "\nGenerado en: " + respuestaServer.nom + "\n" +respuestaServer.cognom)
		
		if(respuestaServer.validacion == "ok") {
		  
		 	/// si la validacion es correcta, muestra la pantalla "home"

			//$.mobile.changePage("segunda.html");	  
			var nivel = respuestaServer.nivel;
			
			if (nivel ==50)
				window.location.href="subastas_asociados.html";
			else
				window.location.href="segunda.html";
				
			sessionStorage.setItem('respuestaServer.validacion', respuestaServer.validacion);                            	
			sessionStorage.setItem('respuestaServer.nom', respuestaServer.nom);
			sessionStorage.setItem('respuestaServer.cognom', respuestaServer.cognom);
			sessionStorage.setItem('respuestaServer.ide', respuestaServer.ide);
			sessionStorage.setItem('respuestaServer.nivel', respuestaServer.nivel);
			sessionStorage.setItem('datosUsuario', datosUsuario);
			sessionStorage.setItem('datosPassword', datosPassword);

		} else {
          alert(html_entity_decode('No puede conectarse, ' + respuestaServer.mensaje, 'ENT_QUOTES'));
		}
  
	})
	return false;
})


$('[required]').on('blur', function () {
    if (!$(this).val().length) { // check if the value is empty
        // Could do an alert or something else
    }
});

//ALTA

$(document).ready(function() {

$('.error').hide();

// Inicialización de la pantalla
//	
// elegimos una imagen de fondo al azar
	
//	var url="http://elmundo.webexpo.es/categorias.php?Accion=ImagenDeFondo";
//	$.getJSON(url,function(cats){
//		$.each(cats, function(id, nombre){
//			var randomID = new Date().getTime();
//			$('.ui-page').css({
//				"background-image": "url('" + nombre + "?r=" + randomID+ "')",
//				"background-repeat": "repeat",
//				"background-position": "top center"
//				});
//			});
//		});

//				$('body').css({
//				"background-image": "url('http://elmundo.webexpo.es/" + respuestaServer.ImagenDeFondo + "?r=" + randomID+ "')",
//				"background-repeat": "repeat",
//				"background-position": "top center"
//				});

// elegimos un anuncio de pie al azar	
//	var url="http://elmundo.webexpo.es/categorias.php?Accion=BannerPublicitario";
//	$.getJSON(url,function(cats){
//		$.each(cats, function(id, nombre){
//			$("#bannerinferior").html('<img style="width:100%" src="' + nombre + '">');
//			});
//		});

// Inicializamos los valores de categoria en sessionStorage
	
	sessionStorage.setItem('CategoriaBase', 0);	
	sessionStorage.setItem('CategoriaNivel1', 0);	
	sessionStorage.setItem('CategoriaNivel2', 0);	
	sessionStorage.setItem('precio', 0);	
	sessionStorage.setItem('periodo', 0);	
	sessionStorage.setItem('Explicacion', '');	

// Código de Rafa
	
	$("#enviar-btn").click(function() {

		//Obtenemos el valor del campo nombre
		var name = $("input#name").val();
		//Validamos el campo nombre, simplemente miramos que no esté vacío
		if (name == "") {
			$("label#name_error").show();
			$("input#name").focus();
			return false;
		}

		//Obtenemos el valor del campo password
		var password = $("input#password").val();

		//Validamos el campo password, simplemente miramos que no esté vacío
		if (password == "") {
			$("label#pass_error").show();
			$("input#password").focus();
			return false;
		}

		//Verificamos que ambas contraseñas sean iguales.
		var password2 = $("input#password2").val();

		//Validamos el campo password, simplemente miramos que no esté vacío
		if (password != password2) {
			$("label#pass2_error").show();
			$("input#password2").focus();
			return false;
		}


		//Obtenemos el valor del campo nom
		var nom = $("input#nom").val();

		//Validamos el campo nom, simplemente miramos que no esté vacío
		if (nom == "") {
			$("label#nom_error").show();
			$("input#nom").focus();
			return false;
		}
		
		
		//Obtenemos el valor del campo cognom
		var cognom = $("input#cognom").val();

		//Validamos el campo cognom, simplemente miramos que no esté vacío
		if (cognom == "") {
			$("label#cognom_error").show();
			$("input#cognom").focus();
			return false;
		}		
		
				//Obtenemos el valor del campo telefon
		var telefon = $("input#telefon").val();

		//Validamos el campo telefon, simplemente miramos que no esté vacío
		if (telefon == "") {
			$("label#telefon_error").show();
			$("input#telefon").focus();
			return false;
		}
		
		
	
  	url = "http://elmundo.webexpo.es/alta.php";
	//Construimos la variable que se guardará en el data del Ajax para pasar al archivo php que procesará los datos
	var dataString = {name: name, password: password, nom: nom, cognom: cognom, telefon: telefon};

	$.getJSON( url, dataString)
	.done(function(respuestaServer) {
			if(respuestaServer.validacion == "ok"){
	
				// omplim les dades i tornem la la primera pantalla	
//				window.location.href="index.html";
				sessionStorage.setItem('datosUsuario', name);
				sessionStorage.setItem('datosPassword', password);

				$('#descripcion_alta').html("");
				$('#register_form').html("<div id='message'></div>");
				$('#message').html("<h2 style=color:#ffffff>¡Ya te has registrado! Recibir&aacute;s un e-mail para confirmar que el email que nos has indicado sea realmente tuyo, activar tu cuenta y poder conectarte a la aplicaci&oacute;n (si no te la llegado el e-mail, comprueba en la carpeta de correos no deseados).</h2>")

		        .hide()
		        .fadeIn(1500, function() {
					$('#message').append("<p class='text-center'><a href='index.html' target='_self'><button data-role='button' class='btn'>Con&eacute;ctate</button></a></p>");
		        });

				}
			else
				{
				$('#descripcion_alta').html("");
				$('#register_form').html("<div id='message'></div>");
				$('#message').html("<h2 style=color:#ffffff>Lo sentimos, hemos tenido un problema con el registro :</h2><h2 style=color:#ff4040>" + respuestaServer.mensaje + ".</h2><h2 style=color:#ffffff>Revisa el mensaje y vuelve a intentarlo.</h2>")

				.hide()
		        .fadeIn(1500, function() {
					$('#message').append("<p class='text-center'><a href='index.html' target='_self'><button data-role='button' class='btn'>Volver a intentarlo</button></a></p>");
		        });

				
				}
  
		});
		return false;
	});
});




//RECUPERAR	

function objetoAjax(){
	var xmlhttp=false;
	try {
		xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
	} catch (e) {
 
	try {
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	} catch (E) {
		xmlhttp = false;
	}
}
 
if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
	  xmlhttp = new XMLHttpRequest();
	}
	return xmlhttp;
}
 

function enviarDatosEmpleado(){
 

  divResultado = document.getElementById('resultado');
  emailrec=document.nuevo_empleado.emailrecuperar.value;


  ajax=objetoAjax();
 
  ajax.open("POST", "http://elmundo.webexpo.es/recuperar.php",true);
  ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
  ajax.send("emailrecuperar="+emailrec)
  ajax.onreadystatechange=function() {
  	if (ajax.readyState==4) {
		resposta = JSON.parse(ajax.responseText);
		if (resposta.Status=='OK')
			alert("Hemos enviado un correo con tus datos. Lo recibiras solo si ya te habías inscrito con anterioridad. Revisalo y registrate");
		else
			alert("No hemos podido enviar tus datos. Motivo : "+html_entity_decode(resposta.Description));
		}
 }
}
 




</script>
</body>
</html>
